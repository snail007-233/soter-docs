<!DOCTYPE html>
<html>
	<head>
		<title>命令行任务</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="js/inc.js"></script>
	</head>
	<body>
		<fieldset>
			<legend>命令行Task任务</legend>
			<ol>
				<li><h2 class="title_h2">Task介绍</h2>
					在网站需求中，往往有一些任务需要在命令行下面用定时任务定期执行，Soter也对命令行进行了支持，
					<br>在Soter里面把这种需求要执行的代码称为任务，一个任务也就是一个Soter_Task类。
					<br>在Task里面我们可以按照Soter框架的正常特性写代码，比如数据库操作，缓存操作等。
				</li>
				<li><h2 class="title_h2">创建Task</h2>
					Task类文件都在application/Task/目录下面，每个Task类都必须继承抽象类Soter_Task，实现抽象方法execute。
					<br>下面我们创建一个Task
					<br><b>1.新建文件：application/Task/My/FirstTask.php</b>
					<br>内容如下：
					<pre class="brush:php">
						class  Task_My_FirstTask extends Soter_Task {
							public function execute(Soter_CliArgs $args) {
								echo $args->get('test');
							}
						}	
					</pre>
					我们看到我们的Task_My_FirstTask类，继承了抽象类Soter_Task，实现了execute方法，接受了一个Soter_CliArgs参数对象，
					<br>通过这个对象我们可以获取命令行传递过来的参数，比如上面传递的--test=hello，
					<br>我们就可以通过$args->get('test')获取hello。
					<br><b>2.命令行执行这个Task任务</b>
					<br>比如执行下面的命令：
					<pre class="brush:php">
						php /home/www/soter/index.php --env=development --task=My_FirstTask --test=hello	
					</pre>
					我们会看到输出了:hello
					<br><b class="text_strong">提示：
						<br>我们可以通过参数 --env指定环境，这里环境就是我们<a href="config.html">config手册部分</a>所指的环境，
						<br>用来告诉Soter使用config目录下面的哪个目录作为配置文件夹目录。</b>
				</li>
				<li><h2 class="title_h2">单例Task</h2>
					<h3 class="title_h3">1.概念</h3>
					对于上面我们继承抽象类Soter_Task创建的自己的任务：Task_My_FirstTask，
					<br>如果我们在计划任务里面每隔一分钟执行一次这个任务，而且这个任务执行的时间大于1分钟，
					<br>那么就会一分钟之后就会同时存在多个Task_My_FirstTask任务在并行执行。如果我们的业务允许这样那么就没什么问题，
					<br><b>但是如果我们的需求是：同一时间只能存在一个相同任务被执行，如果上一次的任务没有执行完毕后面启动的任务应该不执行，并自动退出。</b>
					<br>后面这种“<b class="text_strong">同一时间只能存在一个相同任务被执行的任务</b>”在Soter里面称为“单例Task”。
					<h3 class="title_h3">2.创建单例Task</h3>
					单例Task类文件同样都在application/Task/目录下面，每个单例Task类都必须继承抽象类Soter_Task_Single，实现抽象方法execute。
					<br>下面我们创建一个单例Task
					<br><b>1.新建文件：application/Task/My/SingleTask.php</b>
					<br>内容如下：
					<pre class="brush:php">
						class  Task_My_SingleTask extends Soter_Task_Single {
							public function execute(Soter_CliArgs $args) {
								echo $args->get('test');
								sleep(30);
							}
						}	
					</pre>
					我们看到我们的Task_My_SingleTask类，继承了抽象类Soter_Task_Single，实现了execute方法，接受了一个Soter_CliArgs参数对象，
					<br>通过这个对象我们可以获取命令行传递过来的参数，比如上面传递的--test=hello，
					<br>我们就可以通过$args->get('test')获取hello。
					<br><b>2.命令行执行这个Task任务</b>
					<br>比如执行下面的命令：
					<pre class="brush:php">
						php /home/www/soter/index.php --env=development --task=My_SingleTask--test=hello	
					</pre>
					我们会看到输出了:hello,然后30秒后脚本退出。
					<br><b class="text_strong">提示：
						<br>1.我们可以通过参数 --env指定环境，这里环境就是我们<a href="config.html">config手册部分</a>所指的环境，
						<br>用来告诉Soter使用config目录下面的哪个目录作为配置文件夹目录。
						<br>2.如果我们同时多次执行这个任务，会发现第一次执行没有结束的时候，后面启动执行的任务会自动退出，同一时间只会存在一个任务在执行。
					</b>
				</li>
			</ol>
		</fieldset>
		<script src="js/inc.foot.js"></script>
	</body>
</html>
